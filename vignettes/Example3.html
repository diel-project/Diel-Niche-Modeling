<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Example 3</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Example 3</h1>



<div id="single-species-with-multiple-data-analysis-units" class="section level1">
<h1>Single species with multiple data analysis units</h1>
<div id="author-mason-fidino" class="section level4">
<h4>Author: Mason Fidino</h4>
</div>
<div id="date-2023-05-25" class="section level4">
<h4>Date: 2023-05-25</h4>
<p>Our framework has outlined a process for making inference on the diel
niche of species for a given sampling and spatial period. A next natural
research question is how to link hypotheses about how the diel niche of
a species may change over time or over space. Simply, how to link
spatial or temporal covariates to findings of diel niche classification.
Ideally, a fully hierarchical model that synthetically connects the diel
niche classification to covariates would be specified, such that
parameter estimation is done jointly and all parametric uncertainties
are fully recognized. However, the constrained optimization of the
multinomial model makes this challenging at this time.</p>
<p>We offer a two-staged modeling process that accomplishes the goal.
First, estimate the diel niche for a species at each spatial or temporal
period of interest to identify the most supported hypothesis. Second,
use the hypotheses as data in a subsequent categorical regression model
that links the hypotheses to covariates of interest. It should be
understood that if there is uncertainty in the most supported model then
this does not get acknowledged in the regression model. To remediate
this concern, researchers may want to only consider using hypotheses
with a given high level of probability of support (e.g., model
probability <span class="math inline">\(&gt; 0.80\)</span>).</p>
<p>As one example, Virginia opossum are a predominately nocturnal
species that, with their bare feet, ears, and tail, become more active
during the day during the winter in temperate environments (Gallo et
al. 2022). As a result, we might expect this species to switch between
diel phenotypes over the course of a year. As the previous Chicago data
is from a long-term biodiversity monitoring survey, we compiled 27
different analysis units, each of which represented roughly 28 days of
sampling across 131 sites in Chicago, Illinois. To capture seasonal
variation cameras were deployed in January, April, July, and October,
and data comes from between 2013 and 2019 (all of which is available in
the <code>diel.data.</code> object).</p>
<p>As a first step, we therefore need to 1) load libraries, 2) load the
data, 3) subset that data the opossum analysis units, and 4) classify
the most likely diel phenotype for each analysis unit with
<code>Diel.Niche::diel.fit()</code>. In addition to this we are also
going to calculate the ordinal day an analysis unit started to use as a
covariate in our secondary analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(Diel.Niche)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(bbplot)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(nimble)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(parallel)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(MCMCvis)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># URL to bbplot</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># browseURL(&quot;https://github.com/dapperstats/bbplot&quot;)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data</span>(<span class="st">&quot;diel.data&quot;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset to opossum</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  opossum <span class="ot">&lt;-</span> diel.data[</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    diel.data<span class="sc">$</span>scientificName <span class="sc">==</span> <span class="st">&quot;Didelphis virginiana&quot;</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># convert opossum$min_date to date object</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  opossum<span class="sc">$</span>min_date <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">mdy</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    opossum<span class="sc">$</span>min_date</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># and calculate the ordinal day</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  opossum<span class="sc">$</span>ord_day <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">yday</span>(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    opossum<span class="sc">$</span>min_date</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># A list to store the results</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  diel_results <span class="ot">&lt;-</span> <span class="fu">vector</span>(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;list&quot;</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">length =</span> <span class="fu">nrow</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      opossum</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify most likely diel phenotype in a loop</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(diel_results)){</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># need to convert the row element of opossum to a </span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  matrix for Diel.Niche::diel.fit().</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      tmp <span class="ot">&lt;-</span> Diel.Niche<span class="sc">::</span><span class="fu">diel.fit</span>(</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">as.matrix</span>(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>          opossum[i,<span class="fu">c</span>(<span class="st">&quot;twilight&quot;</span>, <span class="st">&quot;day&quot;</span>,<span class="st">&quot;night&quot;</span>)]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">hyp.set =</span> Diel.Niche<span class="sc">::</span><span class="fu">hyp.sets</span>(</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Traditional&quot;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">n.chains =</span> <span class="dv">2</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">burnin =</span> <span class="dv">5000</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">n.mcmc =</span> <span class="dv">10000</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">prints =</span> <span class="cn">FALSE</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compile results into a data.frame</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      diel_results[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">choice =</span> tmp<span class="sc">$</span>ms.model,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">prob =</span> <span class="fu">max</span>(</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>          tmp<span class="sc">$</span>bf.table[,<span class="dv">2</span>]</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">ord_day =</span> opossum<span class="sc">$</span>ord_day[i],</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">season =</span> opossum<span class="sc">$</span>season[i]</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># bind all of the results together into a data.frame</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  diel_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;rbind&quot;</span>,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    diel_results</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>After this, we are only going to retain analysis units where there is
at least an <span class="math inline">\(0.80\)</span> probability of a
diel phenotype classification. This leaves us with 23 analysis units,
with most occurring in either Summer or Autumn. Furthermore, almost
every analysis unit was classified as nocturnal (<code>N</code>), while
two were classified as cathemeral (<code>C</code>) during the
winter.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  diel_results <span class="ot">&lt;-</span> diel_results[</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    diel_results<span class="sc">$</span>prob <span class="sc">&gt;</span> <span class="fl">0.8</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(diel_results<span class="sc">$</span>choice, diel_results<span class="sc">$</span>season)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Autumn Spring Summer Winter</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   C      0      0      0      2</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   N      9      3      8      1</span></span></code></pre></div>
</div>
</div>
<div id="the-secondary-model" class="section level1">
<h1>The secondary model</h1>
<p>The <code>nimble</code> code to fit the secondary model, as described
in the paper, is:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model_single_species <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">nimbleCode</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndata){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># cathemeral, reference category 1</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        mu[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># diurnal, category 2</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        mu[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">exp</span>( </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">inprod</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            diur_unit_beta[<span class="dv">1</span><span class="sc">:</span>ncov_unit],</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            unit_dm[i, <span class="dv">1</span><span class="sc">:</span>ncov_unit]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># nocturnal, category 3</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        mu[i,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">inprod</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            noct_unit_beta[<span class="dv">1</span><span class="sc">:</span>ncov_unit],</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            unit_dm[i, <span class="dv">1</span><span class="sc">:</span>ncov_unit]</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># rescale to make into a vector of probabilities</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">#  that sum to 1 (i.e., complete the softmax</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">#  function).</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        mu_prob[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> mu[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">/</span> <span class="fu">sum</span>(mu[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Using the categorical distribution here</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="sc">~</span> <span class="fu">dcat</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>          mu_prob[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Priors for the different parameters.</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ncov_unit){</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      diur_unit_beta[k] <span class="sc">~</span> <span class="fu">dnorm</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> <span class="dv">2</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>      noct_unit_beta[k] <span class="sc">~</span> <span class="fu">dnorm</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> <span class="dv">2</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This model requires us to get a few things together in order to fit
the model to the data.</p>
<ol style="list-style-type: decimal">
<li><code>unit_dm</code>: A unit-level design matrix.</li>
<li><code>ndata</code>: The number of analysis units.</li>
<li><code>ncov_unit</code>: The number of columns in
<code>unit_dm</code>.</li>
<li><code>y</code>: A vector of integers that represents which diel
phenotype was selected. In this case 1 = Cathemeral, 2 = Diurnal, and 3
= Nocturnal.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1. Make the unit-level design matrix. The column</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  of 1&#39;s is present for the model intercepts.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  unit_dm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    diel_results<span class="sc">$</span>ord_day</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># scale the data to unit variance</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  unit_dm[,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">scale</span>(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    unit_dm[,<span class="dv">2</span>]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># also include ordinal_day^2</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  unit_dm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    unit_dm,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    unit_dm[,<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2. Calculate number of analysis units.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  ndata <span class="ot">&lt;-</span> <span class="fu">nrow</span>(unit_dm)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3. Calculate the number of parameters for the</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   non-reference categories.</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  ncov_unit <span class="ot">&lt;-</span> <span class="fu">ncol</span>(</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    unit_dm</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4. Get vector of diel classifications.</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      diel_results<span class="sc">$</span>choice,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;N&quot;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co"># put these objects in lists for nimble. Data and constants.</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit_dm =</span> unit_dm</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  constant_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncov_unit =</span> ncov_unit,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">ndata =</span> ndata</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>To fit this model to the data on multiple cores simultaneously, we
need to bundle together all of the <code>nimble</code> code into data
into a function. Here is how we would do that.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>run_MCMC_allcode <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    seed, <span class="co"># random seed for each core.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    data, <span class="co"># data_list</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    cons, <span class="co"># constant_list</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    nimble_model <span class="co"># the nimble model from above</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load nimble on each core</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(nimble)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate initial values for each chain.</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    my_inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">diur_unit_beta =</span> <span class="fu">rnorm</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>              cons<span class="sc">$</span>ncov_unit</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">noct_unit_beta =</span> <span class="fu">rnorm</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>              cons<span class="sc">$</span>ncov_unit</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set seed</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="at">seed =</span> seed)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the model</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    myModel <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">nimbleModel</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">code =</span> nimble_model,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">constants =</span> cons,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">inits =</span> <span class="fu">my_inits</span>()</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compile model</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    CmyModel <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">compileNimble</span>(</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      myModel</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set up MCMC, only using slice samplers</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    mconf <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">configureMCMC</span>(</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>      myModel,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">onlySlice =</span> <span class="cn">TRUE</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Track parameters</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    h <span class="ot">&lt;-</span> <span class="fu">my_inits</span>()</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    mconf<span class="sc">$</span><span class="fu">setMonitors</span>(</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(h)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Build MCMC</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    myMCMC <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">buildMCMC</span>(</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>      mconf</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compile MCMC in C</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    CmyMCMC <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">compileNimble</span>(</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>      myMCMC,</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">project =</span> myModel</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit model to data</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> nimble<span class="sc">::</span><span class="fu">runMCMC</span>(</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>      CmyMCMC, </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">niter =</span> <span class="dv">30000</span>,</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">nburnin =</span> <span class="dv">10000</span>,</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">thin =</span> <span class="dv">10</span>,</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">setSeed =</span> seed</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>And then we fit the model to the data and summarise it. This takes
about one minute to run.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>this_cluster <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">4</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>chain_output <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">parLapply</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> this_cluster, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> run_MCMC_allcode, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cons =</span> constant_list,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">nimble_model =</span> model_single_species</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(this_cluster)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> MCMCvis<span class="sc">::</span><span class="fu">MCMCsummary</span>(</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  chain_output,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">round =</span> <span class="dv">2</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>model_summary</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    mean   sd  2.5%   50% 97.5% Rhat n.eff</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; diur_unit_beta[1] -1.40 1.63 -4.69 -1.36  1.66    1  7853</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; diur_unit_beta[2] -0.06 1.57 -3.18 -0.07  3.07    1  8287</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; diur_unit_beta[3] -1.89 1.34 -4.75 -1.76  0.37    1  8206</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; noct_unit_beta[1]  4.26 1.15  2.22  4.19  6.67    1  8000</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; noct_unit_beta[2] -0.58 0.71 -2.02 -0.57  0.80    1  8000</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; noct_unit_beta[3] -1.38 0.59 -2.61 -1.36 -0.27    1  7841</span></span></code></pre></div>
<p>Looking at the model summary we can see that there is strong evidence
that <code>noct_unit_beta[3]</code>, which is the squared ordinal term,
is negative. Let’s generate the predictions for this across a full
year.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence of days for predictions</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  days <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># scale days as we did to fit the model</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  days_scaled <span class="ot">&lt;-</span> (days <span class="sc">-</span> <span class="fu">mean</span>(diel_results<span class="sc">$</span>ord_day)) <span class="sc">/</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(diel_results<span class="sc">$</span>ord_day)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction data.frame</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  pred_dm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    days_scaled,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    days_scaled<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># make model output into a matrix</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  my_mcmc <span class="ot">&lt;-</span> <span class="fu">do.call</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;rbind&quot;</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    chain_output</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># And convert that into a named list, with a set of parameters</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  for each non-reference category.</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  my_mcmc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">diur_unit_beta =</span> my_mcmc[,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grep</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;diur_unit_beta&quot;</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(my_mcmc)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">noct_unit_beta =</span> my_mcmc[,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grep</span>(</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;noct_unit_beta&quot;</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(my_mcmc)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions for each category and exponentiate. The</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#  prediction for the reference category is exp(0) = 1.</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  diur_pred <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    my_mcmc<span class="sc">$</span>diur_unit_beta <span class="sc">%*%</span> pred_dm</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  noct_pred <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    my_mcmc<span class="sc">$</span>noct_unit_beta <span class="sc">%*%</span> pred_dm</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co"># The denominator for softmax to scale to probabilities.</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  denom <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> diur_pred <span class="sc">+</span> noct_pred</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co"># and get the probability for nocturnality.</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  noct_prob <span class="ot">&lt;-</span> noct_pred <span class="sc">/</span> denom</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate median and 95% CI</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  noct_prob <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    noct_prob,</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>,</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    quantile,</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs =</span> <span class="fu">c</span>(</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>With these predictions we can plot out the probability of
nocturnality as a function of ordinal day. You can see here that the
probability of nocturnality greatly decreases at the start and end of
the year. However, there is substantial uncertainty around this given
that we had less data during the spring and winter.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set margins</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a blank canvas</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">blank</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">366</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">bty =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxs =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxs =</span> <span class="st">&quot;i&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add y axis</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">axis_blank</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">2</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add x axis</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">axis_blank</span>(</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">1</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">minor =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">365</span>,<span class="dv">73</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add text to y axis</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">axis_text</span>(</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">2</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fl">0.75</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add text to x axis</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">axis_text</span>(</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">365</span>,<span class="dv">73</span>)[<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">1</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fl">0.55</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">365</span>,<span class="dv">73</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add y axis label</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">axis_text</span>(</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Pr(Nocturnal)&quot;</span>,</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">2</span>,</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fl">2.25</span>,</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">cex =</span> <span class="fl">1.5</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add x axis label</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">axis_text</span>(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Ordinal day&quot;</span>,</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">1</span>,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fl">2.25</span>,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">cex =</span> <span class="fl">1.5</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add shaded ribbon</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    bbplot<span class="sc">::</span><span class="fu">ribbon</span>(</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> days,</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">t</span>(noct_prob[<span class="sc">-</span><span class="dv">2</span>,]),</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;gray40&quot;</span>,</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add median line</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> days,</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> noct_prob[<span class="dv">2</span>,],</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">4</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add thicker &#39;L&#39; to x and y axis.</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>(</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">Figure 3.1. Opossum are predominately nocturnal
during the middle of the year, but this precipitously drops off at the
start and end of a year. The solid black line represents the median
probability of nocturnality while the shaded ribbon is the 95% credible
interval.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Gallo, T., Fidino, M., Gerber, B., Ahlers, A. A., Angstmann, J. L.,
Amaya, M., Concilio, A. L., Drake, D., Gray, D., Lehrer, E. W., Murray,
M. H., Ryan, T. J., Cassady St. Clair, C., Salsbury, C. M., Sander, H.
A., Stankowich, T., Williamson, J., Belaire, J. A., Simon, K., and
Magle, S. B. (2022). Mammals adjust diel activity across gradients of
urbanization. eLife. <a href="https://elifesciences.org/articles/74756" class="uri">https://elifesciences.org/articles/74756</a></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
