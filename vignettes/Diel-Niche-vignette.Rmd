---
title: "Diel-Niche-vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Diel-Niche-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{bayesplot,ggplot2,coda,Diel.Niche}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introducion
The Diel.Niche pacakge is setup to evaluate how animals use the three fundamental periods of light: twilight (dawn & dusk), daytime, and nighttime. First, install and load the library
```{r package}
#devtools::install_github("diel-project/Diel-Niche-Modeling",ref="main")

library(Diel.Niche)
```

There are many hypotheses and hypothesis sets available. Their names are
```{r hyp}
  what.hyp()
```

If you want a short description of a specific hypotheses:
```{r hyp2}
  what.hyp("D")
```

There are five main sets of hypotheses, which can be viewed
```{r 3dplot1}
diel.plot(hyp=hyp.sets("Maximizing"))

diel.plot(hyp=hyp.sets("Traditional"))

diel.plot(hyp=hyp.sets("General"))

diel.plot(hyp=hyp.sets("Threshold"))

diel.plot(hyp=hyp.sets("Variation"))

```

We can also view specific hypotheses, as
```{r 3dplot2}
diel.plot("D",more.points = TRUE)

diel.plot("N",more.points = TRUE)
```

# Simulate Data
To simulate data based on a diel hypothesis, we need define a hypothesis using it's coded name. Pick a hypothesis to simulate data from and how many samples.
```{r sim1}
  set.seed(45451)
  hyp=c("CR")
  sim=sim.diel(hyp=hyp,n.sample=100)
  p=sim$p
  y=sim$y

```

# Setup hypotheses set and fit models

You can setup your own model set or use pre-defined model sets as
```{r hyp.set}
  hyp.set = c("D","CR") #manual
  hyp.set=hyp.sets("Traditional") #pre-defined
```

Lastly, we fit our model and look at the model probabilities
```{r fit}
  out = diel.fit(y,hyp.set)
  out$bf.table
```

You can discover the available outputs as

```{r results}
attributes(out)

?diel.fit
```

The default is to not return posterior samples, so to change that we can do,
```{r results2}
  out = diel.fit(y,hyp.set,n.chains=2,post.fit = TRUE)

#look at convergence
  out$gelm.diag
#look at most supported models posteriors
  plot(coda::as.mcmc(out$post.samp.ms.model))
```

# Plotting

We can plot our most supported models posterior probability distribution a number of ways. Using ggplo2 and bayesplot:

```{r plot, eval = FALSE}
library(bayesplot)
library(ggplot2)


posteriors=coda::as.mcmc(out$post.samp.ms.model)

plot_title <- ggtitle("Posterior distributions",
                      "with medians and 80% intervals")
mcmc_areas(posteriors, prob = 0.8) + plot_title+ 
  geom_vline(xintercept=p, linetype="dashed", 
                color = c("red","green","purple"), size=1)


```

Another way to examine our hypothesis to plot the theoretical niche space for the hypothesis along with the posterior samples. Or, show the whole hypothesis set

```{r 3dplot}
diel.plot(hyp=out$ms.model,more.points = TRUE,
          posteriors=out$post.samp.ms.model)


diel.plot(hyp=hyp.set,
          posteriors=out$post.samp.ms.model)

```

You do not need to rely on our definitions of diel hypotheses. If you are interested in categorizing a diel modality based on 0.7 probabilty or higher, you could adjust the hypotheses using diel.inequaties()
```{r manual example}

diel.setup=diel.ineq(xi.min.dom = 0.7)
diel.plot(hyp=hyp.sets("Traditional"),diel.setup=diel.setup)

#If you want to separate the hypotheses and reduce the parameter space of cathmerality,
diel.setup=diel.ineq(xi.min.dom = 0.7,separation=0.1)
diel.plot(hyp=hyp.sets("Traditional"),diel.setup=diel.setup)

```
This new set could be used to simulate data from and fit the same models as, 
```{r manual example2}
y=sim.diel(hyp="CR",n.sample = 100,diel.setup=diel.setup)$y

out = diel.fit(y,hyp.set=hyp.sets("Traditional"),n.chains=2,post.fit = TRUE,diel.setup=diel.setup)

diel.plot(hyp=hyp.sets("Traditional"),posteriors = out$post.samp.ms.model,diel.setup=diel.setup)
  
```

If you are using RStudio and no figure is opening
Tools-->Global Options-->Advanced-->Rengering Engine
Choose "Desktop OpenGL{}
restart RStudio completely